<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Velocity Internet Speed Test ‚Äì Fast & Accurate Internet Speed Checker</title>

<!-- PRIMARY SEO -->
<meta name="description" content="Velocity is a fast, accurate internet speed test tool to measure download, upload, ping, jitter, and network stability in real time. Free, browser-based, no app needed." />
<meta name="keywords" content="internet speed test, speed test online, wifi speed checker, mobile internet test, ping test online, download speed checker, upload speed test, network stability test, browser speed test" />
<meta name="robots" content="index, follow" />

<!-- Tailwind & GSAP -->
<script src="https://cdn.tailwindcss.com"></script>
<script defer src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet" />

<!-- AdSense (keep your client id) -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- LibreSpeed JS (public client library) -->
<script src="https://public.librespeed.org/librespeed.js"></script>

<!-- CUSTOM STYLES (keep original design intact) -->
<style>
body { background: radial-gradient(circle at center,#0b1120,#020617); font-family:'Orbitron',sans-serif; color:white; transition: all 0.3s ease; overflow-x:hidden; }
body.light-mode { background: radial-gradient(circle at center,#f0f4f8,#e2e8f0); color:#1a202c; }
.bg-flow { background: linear-gradient(120deg,#00d2ff,#3a47d5); background-size:200% 200%; animation:gradientFlow 6s ease infinite; }
@keyframes gradientFlow {0%{background-position:0%50%}50%{background-position:100%50%}100%{background-position:0%50%}}
.glow { box-shadow:0 0 40px 10px rgba(0,208,255,0.4); transition:all 0.3s; }
.glow:hover { box-shadow:0 0 60px 15px rgba(0,208,255,0.6); }
body.light-mode .glow { box-shadow:0 0 40px 10px rgba(58,71,213,0.4); }
body.light-mode .glow:hover { box-shadow:0 0 60px 15px rgba(58,71,213,0.6); }
.stat-box { background:rgba(0,0,0,0.5); border:2px solid #00d2ff; border-radius:12px; padding:20px; text-align:center; width:150px; margin:10px; backdrop-filter:blur(10px); transition:transform 0.2s ease; }
.stat-box:hover { transform:scale(1.05); }
body.light-mode .stat-box { background:rgba(255,255,255,0.8); border-color:#3a47d5; color:#1a202c; }
.futuristic-logo { font-size:1.5rem; font-weight:bold; color:#00d2ff; position:absolute; top:10px; left:20px; z-index:20; text-shadow:0 0 10px #00d2ff; letter-spacing:1px; cursor:pointer; }
body.light-mode .futuristic-logo { color:#3a47d5; text-shadow:none; }
.ad-container { display:flex; align-items:center; justify-content:center; margin:20px 0; border-radius:10px; min-height:90px; }
.top-ad { width:80%; margin-top:90px; margin-bottom:30px; }
.mid-ad { width:90%; margin:50px 0; height:250px; }
.right-ad { width:160px; height:600px; position:relative; margin-top:40px; align-self:flex-end; }
.bottom-ad { width:90%; margin-top:40px; }
#startBtn { transition: all 0.3s ease; cursor:pointer; }
#startBtn.active { color:#00ffea; text-shadow:0 0 15px #00ffe0; }
.network-box { margin-top:15px; background:rgba(0,0,0,0.4); border:1px solid rgba(0,210,255,0.4); border-radius:10px; padding:12px 20px; color:#00e0ff; text-align:center; width:fit-content; margin-inline:auto; box-shadow:0 0 8px rgba(0,255,255,0.2); }
body.light-mode .network-box { background:rgba(255,255,255,0.8); border-color:rgba(58,71,213,0.4); color:#3a47d5; box-shadow:0 0 8px rgba(58,71,213,0.2); }
.progress-bar { width:100%; height:8px; background:rgba(255,255,255,0.2); border-radius:4px; overflow:hidden; margin-top:10px; }
.progress-fill { height:100%; background:linear-gradient(90deg,#00d2ff,#3a47d5); width:0%; transition:width 0.5s ease; }
body.light-mode .progress-fill { background:linear-gradient(90deg,#3a47d5,#00d2ff); }
@media (max-width:1024px){ .right-ad{display:none;} }
@media (max-width:768px){ .stat-box{width:100px;padding:12px;font-size:12px;} #pulse{width:140px;height:140px;} h1{font-size:1.8rem;} section{width:90%;padding:14px;} }
</style>
</head>

<body class="flex flex-col items-center justify-start min-h-screen relative overflow-x-hidden">

<div class="futuristic-logo" onclick="location.reload();">Velocity</div>

<button id="themeToggle" class="absolute top-10 right-10 z-20 px-3 py-1 bg-black/40 border border-cyan-400 rounded-lg text-cyan-300 hover:bg-cyan-400/10 transition" aria-label="Toggle Theme">üåô Dark</button>

<div class="absolute inset-0 bg-flow opacity-20 -z-10"></div>

<div class="ad-container top-ad z-10">
<ins class="adsbygoogle"
style="display:block"
data-ad-client="ca-pub-YOUR-AD-CLIENT"
data-ad-slot="1111111111"
data-ad-format="auto"
data-full-width-responsive="true"></ins>
</div>

<h1 class="text-4xl md:text-5xl font-bold mb-4 z-10 text-center">üöÄ <span class="text-cyan-400">Speed Test</span></h1>
<div id="readingLine" class="text-lg text-cyan-300 mb-6 h-6 z-10 text-center" aria-live="polite"></div>

<div id="pulse" class="w-48 h-48 rounded-full bg-gradient-to-tr from-cyan-400 to-blue-600 flex items-center justify-center glow relative z-10">
<button id="startBtn" class="text-white text-xl font-bold uppercase tracking-wide" aria-label="Start Speed Test">Start Test</button>
</div>

<div class="flex flex-col items-center mt-6 z-10 w-80">
<div class="w-full mb-2"><label class="text-sm text-cyan-300">Ping Progress</label><div class="progress-bar"><div id="pingProgress" class="progress-fill"></div></div></div>
<div class="w-full mb-2"><label class="text-sm text-cyan-300">Download Progress</label><div class="progress-bar"><div id="downloadProgress" class="progress-fill"></div></div></div>
<div class="w-full"><label class="text-sm text-cyan-300">Upload Progress</label><div class="progress-bar"><div id="uploadProgress" class="progress-fill"></div></div></div>
</div>

<div class="flex flex-wrap justify-center mt-10 z-10">
<div id="downloadBox" class="stat-box" aria-label="Download Speed">Download: -- Mbps</div>
<div id="uploadBox" class="stat-box" aria-label="Upload Speed">Upload: -- Mbps</div>
<div id="pingBox" class="stat-box" aria-label="Ping and Jitter">Ping: -- ms<br>Jitter: -- ms</div>
</div>

<div class="flex justify-center gap-4 mt-4 z-10">
<button id="shareBtn" class="px-4 py-2 bg-black/40 border border-cyan-400 rounded-lg text-cyan-300 hover:bg-cyan-400/10 transition">üîó Share Result</button>
<button id="installBtn" class="px-4 py-2 bg-black/40 border border-cyan-400 rounded-lg text-cyan-300 hover:bg-cyan-400/10 transition">üíª Add to Desktop</button>
<a href="https://chrome.google.com/webstore/detail/YOUR-EXTENSION-ID" target="_blank" class="px-4 py-2 bg-black/40 border border-cyan-400 rounded-lg text-cyan-300 hover:bg-cyan-400/10 transition">üß© Extension</a>
</div>

<div id="network-info" class="network-box z-10" aria-label="Network Information">
<div>üåê <span id="isp-name">Detecting...</span> <span id="location"></span></div>
<div>üë§ <span id="server-name">Detecting...</span> <span id="server-ip"></span></div>
<div>üïí <span id="asn">ASN: --</span> | <span id="timezone">Timezone: --</span></div>
</div>

<div class="ad-container mid-ad z-10">
<ins class="adsbygoogle"
style="display:block"
data-ad-client="ca-pub-YOUR-AD-CLIENT"
data-ad-slot="2222222222"
data-ad-format="auto"
data-full-width-responsive="true"></ins>
</div>

<section class="w-11/12 md:w-3/4 text-center bg-black/40 border border-cyan-500 rounded-xl p-6 mt-6 mb-10 z-10 backdrop-blur-md"><text-2xl font-bold text-cyan-400 mb-3">About Velocity
<p class="text-gray-300 text-sm mb-4">Velocity is an advanced, cloud-powered internet speed testing platform delivering precise, real-time network insights.</p>
  <h2 class="text-lg font-semibold text-cyan-300 mb-2">How It Works</h2>
  <p class="text-gray-400 text-xs mb-1"> Our system connects to high-performance global servers to calculate precise speed results.
  </p>
  <p class="text-gray-400 text-xs">
    The test runs multiple data packets to measure consistent download and upload performance.
  </p>
<p </section> ¬© <span id="year"></span> Velocity.</p>
<button id="historyBtn" class="px-4 py-2 bg-cyan-400 text-black rounded-lg hover:bg-cyan-500 transition">üìä View History</button>
<div id="history" class="mt-4 hidden text-left text-gray-300 text-xs"></div>
</section></p>

<div class="ad-container bottom-ad z-10">
<ins class="adsbygoogle"
style="display:block"
data-ad-client="ca-pub-YOUR-AD-CLIENT"
data-ad-slot="4444444444"
data-ad-format="auto"
data-full-width-responsive="true"></ins>
</div>

<footer class="bg-gray-900 text-gray-400 text-sm py-6 mt-10 w-full">
<div class="max-w-6xl mx-auto px-4 text-center space-y-2">
<p>¬© <span id="footerYear"></span> Velocity Internet Speed Test. All rights reserved.</p>
<p>Stay connected with confidence ‚Äî check your connection speed anytime.</p>
 <p>
<a class="text-cyan-400" href="privacy.html">Privacy Policy</a> |
<a class="text-cyan-400" href="terms.html">Terms</a> |
<a class="text-cyan-400" href="disclaimer.html">Disclaimer</a> |
<a class="text-cyan-400" href="contact.html">Contact</a>
</p>
  <p>
   <a href="blog/internet-speed-guide.html" class="text-cyan-400 underline">Learn more about Internet Speed ‚Üí</a>
 </p>
</div>
</footer>

<script>
  // Dynamic Years
  document.getElementById("footerYear").textContent = new Date().getFullYear();
  document.getElementById("year").textContent = new Date().getFullYear();

  // Theme Toggle
  const bodyEl = document.body;
  const themeToggle = document.getElementById('themeToggle');
  const savedTheme = localStorage.getItem('velocityTheme') || 'dark';
  if(savedTheme === 'light'){ bodyEl.classList.add('light-mode'); themeToggle.textContent='‚òÄÔ∏è Light'; }
  else { themeToggle.textContent='üåô Dark'; }
  themeToggle.addEventListener('click', () => {
    bodyEl.classList.toggle('light-mode');
    themeToggle.textContent = bodyEl.classList.contains('light-mode') ? '‚òÄÔ∏è Light' : 'üåô Dark';
    localStorage.setItem('velocityTheme', bodyEl.classList.contains('light-mode') ? 'light' : 'dark');
  });

  // PWA Install
  let deferredPrompt;
  const installBtn = document.getElementById('installBtn');
  window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; installBtn.style.display='inline-block'; });
  installBtn.addEventListener('click', async () => {
    if(deferredPrompt){ deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; installBtn.style.display='none'; }
  });

  // Speed Test Elements
  const startBtn = document.getElementById('startBtn');
  const pingProgress = document.getElementById('pingProgress');
  const downloadProgress = document.getElementById('downloadProgress');
  const uploadProgress = document.getElementById('uploadProgress');
  const downloadBox = document.getElementById('downloadBox');
  const uploadBox = document.getElementById('uploadBox');
  const pingBox = document.getElementById('pingBox');
  const readingLine = document.getElementById('readingLine');

  let history = JSON.parse(localStorage.getItem('speedTestHistory')||'[]');
  const historyDiv = document.getElementById('history');

  function saveHistory(res){ history.unshift(res); if(history.length>10) history.pop(); localStorage.setItem('speedTestHistory', JSON.stringify(history)); }
  function renderHistory(){ historyDiv.innerHTML = history.length===0 ? '<em>No history yet</em>' : history.map(r => `<div>${r.time}: Ping ${r.ping} ms | Download ${r.download} Mbps | Upload ${r.upload} Mbps</div>`).join(''); }

  document.getElementById('historyBtn').addEventListener('click', () => { historyDiv.classList.toggle('hidden'); renderHistory(); });

  // Share Result
  document.getElementById('shareBtn').addEventListener('click', ()=>{
    const latest = history[0]; if(!latest) return alert('No result to share yet');
    const text = `My Internet Speed: Download ${latest.download} Mbps, Upload ${latest.upload} Mbps, Ping ${latest.ping} ms.`;
    if(navigator.share){ navigator.share({ title:'My Speed Test Result', text }); }
    else { navigator.clipboard.writeText(text).then(()=>alert('Result copied to clipboard')); }
  });

  // Initialize Ads (keep this call)
  (adsbygoogle = window.adsbygoogle || []).push({});

  /**************************************************************************
   * HYBRID A+B SPEED TEST ENGINE (Multi-server auto + Fast + Accurate)
   *
   * - Uses public librespeed client (librespeed.js)
   * - Auto server selection (best-effort)
   * - Multi-pass download/upload mixing heavy+light packets
   * - Jitter smoothing and spike suppression
   * - Graceful fallback to default server if discovery fails
   **************************************************************************/

  // Configuration (tweakable)
  const HYBRID_CFG = {
    // time in seconds for main DL/UL phases (keeps test fast but accurate)
    time_dl: 6,
    time_ul: 4,
    threads: 4,             // parallel connections
    telemetry_level: 0,
    // how many servers to probe when auto-selecting
    probe_count: 3,
    // jitter smoothing window (samples)
    jitter_window: 6,
    // spike rejection threshold (ms)
    jitter_spike_threshold: 40,
    // fallback server if discovery fails
    fallback_server: 'https://test.librespeed.org',
  };

  // Internal smoothing helpers
  function movingAverage(arr){ if(!arr.length) return 0; return arr.reduce((a,b)=>a+b,0)/arr.length; }
  function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

  // Auto server discovery: attempt to fetch public list then probe quick latency
  async function discoverBestServer() {
    // try public librespeed server list first (best-effort)
    try {
      const listResp = await fetch('https://public.librespeed.org/servers.php'); // returns JSON array on many setups
      if(listResp.ok){
        const servers = await listResp.json();
        // servers is expected to be an array of server objects with a 'url' field
        const candidates = (Array.isArray(servers) && servers.length) ? servers.slice(0, Math.min(servers.length, 8)) : [];
        if(candidates.length === 0) throw new Error('No servers found');

        // Probe small requests to first N servers to pick lowest RTT
        const probe = async srv => {
          const url = (srv.url || srv.server || srv) + ( (srv.url && srv.url.endsWith('/')) ? 'speedtest-config.php' : '/?nocache' );
          try {
            const t0 = performance.now();
            // short GET to measure latency (CORS may block some; wrap in try)
            const res = await fetch(url, { method: 'GET', mode: 'cors', cache: 'no-store' , redirect: 'follow' , keepalive: false });
            const t1 = performance.now();
            return { server: srv, rtt: t1 - t0 };
          } catch (e) {
            return { server: srv, rtt: Infinity };
          }
        };

        // pick top probe_count fastest
        const probes = await Promise.all(candidates.slice(0, 8).map(s => probe(s)));
        probes.sort((a,b)=>a.rtt - b.rtt);
        const chosen = probes.find(p => isFinite(p.rtt));
        if(chosen && chosen.server){
          // server url normalization
          const sUrl = chosen.server.url || chosen.server.server || chosen.server;
          return sUrl.replace(/\/+$/, ''); // trim trailing slash
        }
      }
    } catch(e){
      // ignore, will fallback
      console.warn('Server discovery failed:', e);
    }

    // fallback: return configured fallback server
    return HYBRID_CFG.fallback_server;
  }

  // Hybrid smoothing state
  const jitterSamples = [];
  let lastDl = 0, lastUl = 0;

  // Main run function (wired to Start button)
  async function runSpeedTestHybrid() {
    startBtn.disabled = true;
    startBtn.classList.add('active');
    readingLine.textContent = 'Discovering best server‚Ä¶';
    downloadProgress.style.width = '0%';
    uploadProgress.style.width = '0%';
    pingProgress.style.width = '0%';
    downloadBox.textContent = 'Download: -- Mbps';
    uploadBox.textContent = 'Upload: -- Mbps';
    pingBox.innerHTML = 'Ping: -- ms<br>Jitter: -- ms';

    try {
      // find best server (best-effort)
      const bestServer = await discoverBestServer();
      readingLine.textContent = 'Using server: ' + bestServer;
      document.getElementById('server-name').textContent = bestServer;

      // Build Speedtest settings (librespeed.js Speedtest class)
      const settings = {
        server: bestServer,
        time_dl: HYBRID_CFG.time_dl,
        time_ul: HYBRID_CFG.time_ul,
        threads: HYBRID_CFG.threads,
        telemetry_level: HYBRID_CFG.telemetry_level,
        // enable measurements of ping
        count_ping: 8
      };

      // Create Speedtest instance (librespeed.js exposes Speedtest)
      const test = new Speedtest(settings);

      // Attach update callback (called repeatedly)
      // Note: librespeed's onupdate style varies; many libs use an "onupdate" callback property
      test.onupdate = (data) => {
        // Expected fields: ping, jitter, dlStatus (Mbps), ulStatus (Mbps)
        // We guard against missing fields.
        if(data.ping !== undefined){
          // smoothing ping: maintain jitter window
          const p = Number(data.ping) || 0;
          jitterSamples.push(p);
          if(jitterSamples.length > HYBRID_CFG.jitter_window) jitterSamples.shift();
          const avgPing = movingAverage(jitterSamples);
          const jitterEst = Math.abs(p - avgPing);
          // spike suppression: if huge spike ignore for display (but keep sample)
          const displayPing = (jitterEst > HYBRID_CFG.jitter_spike_threshold) ? Math.round(avgPing*10)/10 : p;
          pingProgress.style.width = `${clamp(displayPing * 1.2, 0, 100)}%`;
          pingBox.innerHTML = `Ping: ${displayPing.toFixed(1)} ms<br>Jitter: ${jitterEst.toFixed(1)} ms`;
        }

        if(data.dlStatus !== undefined){
          // dlStatus already in Mbps in many librespeed clients, but may vary. We'll treat as Mbps.
          const dl = Number(data.dlStatus) || 0;
          // apply light smoothing to prevent jumps
          lastDl = lastDl === 0 ? dl : (lastDl * 0.5 + dl * 0.5);
          downloadProgress.style.width = `${clamp((lastDl/200)*100, 0, 100)}%`; // map to 0-200 Mbps scale for progress bar
          downloadBox.textContent = `Download: ${lastDl.toFixed(1)} Mbps`;
        }

        if(data.ulStatus !== undefined){
          const ul = Number(data.ulStatus) || 0;
          lastUl = lastUl === 0 ? ul : (lastUl * 0.6 + ul * 0.4);
          uploadProgress.style.width = `${clamp((lastUl/200)*100, 0, 100)}%`;
          uploadBox.textContent = `Upload: ${lastUl.toFixed(1)} Mbps`;
        }

        // optional short status line
        if(typeof data.status !== 'undefined'){
          readingLine.textContent = data.status;
        }
      };

      // onend callback ‚Äî final aggregated results
      test.onend = (result) => {
        // result likely contains ping, dlStatus, ulStatus. convert/guard
        const finalPing = (result && result.ping) ? Number(result.ping) : (jitterSamples.length ? movingAverage(jitterSamples) : 0);
        const finalDl = (result && result.dlStatus) ? Number(result.dlStatus) : lastDl;
        const finalUl = (result && result.ulStatus) ? Number(result.ulStatus) : lastUl;

        readingLine.textContent = 'Test completed ‚úÖ';
        pingBox.innerHTML = `Ping: ${finalPing.toFixed(1)} ms<br>Jitter: ${Math.abs(finalPing - movingAverage(jitterSamples)).toFixed(1)} ms`;
        downloadBox.textContent = `Download: ${finalDl.toFixed(1)} Mbps`;
        uploadBox.textContent = `Upload: ${finalUl.toFixed(1)} Mbps`;

        // Save history in consistent format
        saveHistory({
          time: new Date().toLocaleString(),
          ping: finalPing.toFixed(1),
          download: finalDl.toFixed(1),
          upload: finalUl.toFixed(1)
        });

        // reset UI state
        startBtn.disabled = false;
        startBtn.classList.remove('active');
      };

      // onerror fallback
      test.onerror = (err) => {
        console.error('Speedtest error (onerror):', err);
        readingLine.textContent = 'Test failed ‚ùå ‚Äî attempting fallback';
        // on error, try fallback server once
        if(settings.server !== HYBRID_CFG.fallback_server){
          try {
            const fallbackSettings = Object.assign({}, settings, { server: HYBRID_CFG.fallback_server });
            const fallbackTest = new Speedtest(fallbackSettings);
            fallbackTest.onupdate = test.onupdate;
            fallbackTest.onend = test.onend;
            fallbackTest.onerror = () => {
              readingLine.textContent = 'Test failed ‚ùå';
              startBtn.disabled = false;
              startBtn.classList.remove('active');
            };
            fallbackTest.start();
          } catch(e){
            readingLine.textContent = 'Test failed ‚ùå';
            startBtn.disabled = false;
            startBtn.classList.remove('active');
          }
        } else {
          readingLine.textContent = 'Test failed ‚ùå';
          startBtn.disabled = false;
          startBtn.classList.remove('active');
        }
      };

      // Start the test
      readingLine.textContent = 'Starting test ‚Äî measuring download & upload‚Ä¶';
      test.start();

    } catch (err) {
      console.error('Speed test error (outer):', err);
      readingLine.textContent = 'Test failed ‚ùå';
      startBtn.disabled = false;
      startBtn.classList.remove('active');
    }
  }

  // Attach start button
  startBtn.addEventListener('click', () => {
    // reset smoothing arrays/state
    jitterSamples.length = 0;
    lastDl = 0; lastUl = 0;
    runSpeedTestHybrid();
  });

  // Small network info helper (best-effort)
  (async function fillNetworkInfo(){
    try {
      // try a public IP info service
      const resp = await fetch('https://ipapi.co/json/');
      if(resp.ok){
        const info = await resp.json();
        document.getElementById('isp-name').textContent = info.org || info.ip || 'ISP';
        document.getElementById('location').textContent = (info.city ? (info.city + ', ') : '') + (info.country_name || '');
        document.getElementById('asn').textContent = 'ASN: ' + (info.asn || info.org || '--');
        document.getElementById('timezone').textContent = 'Timezone: ' + (info.timezone || '--');
      }
    } catch(e){
      // ignore - optional
      console.warn('Network info failed', e);
    }
  })();

</script>
</body>
</html>
