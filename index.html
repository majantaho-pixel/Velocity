<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Velocity Internet Speed Test â€“ Custom Advanced</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet" />

<style>
body { background: radial-gradient(circle at center,#0b1120,#020617); font-family:'Orbitron',sans-serif; color:white; transition: all 0.3s ease; overflow-x:hidden; }
body.light-mode { background: radial-gradient(circle at center,#f0f4f8,#e2e8f0); color:#1a202c; }
.bg-flow { background: linear-gradient(120deg,#00d2ff,#3a47d5); background-size:200% 200%; animation:gradientFlow 6s ease infinite; }
@keyframes gradientFlow {0%{background-position:0%50%}50%{background-position:100%50%}100%{background-position:0%50%}}
.glow { box-shadow:0 0 40px 10px rgba(0,208,255,0.4); transition:all 0.3s; }
.glow:hover { box-shadow:0 0 60px 15px rgba(0,208,255,0.6); }
body.light-mode .glow { box-shadow:0 0 40px 10px rgba(58,71,213,0.4); }
body.light-mode .glow:hover { box-shadow:0 0 60px 15px rgba(58,71,213,0.6); }
.stat-box { background:rgba(0,0,0,0.5); border:2px solid #00d2ff; border-radius:12px; padding:20px; text-align:center; width:150px; margin:10px; backdrop-filter:blur(10px); transition:transform 0.2s ease; }
.stat-box:hover { transform:scale(1.05); }
body.light-mode .stat-box { background:rgba(255,255,255,0.8); border-color:#3a47d5; color:#1a202c; }
.progress-bar { width:100%; height:8px; background:rgba(255,255,255,0.2); border-radius:4px; overflow:hidden; margin-top:10px; }
.progress-fill { height:100%; background:linear-gradient(90deg,#00d2ff,#3a47d5); width:0%; transition:width 0.2s ease; }
body.light-mode .progress-fill { background:linear-gradient(90deg,#3a47d5,#00d2ff); }
</style>
</head>

<body class="flex flex-col items-center justify-start min-h-screen relative overflow-x-hidden">

<div class="futuristic-logo" onclick="location.reload();">Velocity</div>

<div id="pulse" class="w-48 h-48 rounded-full bg-gradient-to-tr from-cyan-400 to-blue-600 flex items-center justify-center glow relative z-10 mt-32">
<button id="startBtn" class="text-white text-xl font-bold uppercase tracking-wide" aria-label="Start Speed Test">Start Test</button>
</div>

<div class="flex flex-col items-center mt-6 z-10 w-80">
<div class="w-full mb-2"><label class="text-sm text-cyan-300">Ping Progress</label><div class="progress-bar"><div id="pingProgress" class="progress-fill"></div></div></div>
<div class="w-full mb-2"><label class="text-sm text-cyan-300">Download Progress</label><div class="progress-bar"><div id="downloadProgress" class="progress-fill"></div></div></div>
<div class="w-full"><label class="text-sm text-cyan-300">Upload Progress</label><div class="progress-bar"><div id="uploadProgress" class="progress-fill"></div></div></div>
</div>

<div class="flex flex-wrap justify-center mt-10 z-10">
<div id="downloadBox" class="stat-box" aria-label="Download Speed">Download: -- Mbps</div>
<div id="uploadBox" class="stat-box" aria-label="Upload Speed">Upload: -- Mbps</div>
<div id="pingBox" class="stat-box" aria-label="Ping">Ping: -- ms<br>Jitter: -- ms</div>
</div>

<script>
// Elements
const startBtn = document.getElementById('startBtn');
const pingProgress = document.getElementById('pingProgress');
const downloadProgress = document.getElementById('downloadProgress');
const uploadProgress = document.getElementById('uploadProgress');
const downloadBox = document.getElementById('downloadBox');
const uploadBox = document.getElementById('uploadBox');
const pingBox = document.getElementById('pingBox');

// History
let history = JSON.parse(localStorage.getItem('speedTestHistory') || '[]');
function saveHistory(res){ history.unshift(res); if(history.length>10) history.pop(); localStorage.setItem('speedTestHistory', JSON.stringify(history)); }

// Ping + Jitter
async function pingTest(url, count=5){
    let times=[];
    for(let i=0;i<count;i++){
        let start=performance.now();
        try{ await fetch(url+'?cache='+Math.random(), {cache:'no-store'}); } catch(e){}
        let end=performance.now();
        times.push(end-start);
        pingProgress.style.width = `${((i+1)/count)*100}%`;
    }
    const avg = times.reduce((a,b)=>a+b,0)/times.length;
    const jitter = Math.max(...times)-Math.min(...times);
    return {avg:avg.toFixed(1), jitter:jitter.toFixed(1)};
}

// Download
async function downloadTest(url, sizeMB=10){
    const start = performance.now();
    await fetch(url+'?cache='+Math.random(), {cache:'no-store'});
    const end = performance.now();
    const seconds = (end-start)/1000;
    const mbps = ((sizeMB*8)/seconds).toFixed(1);
    downloadProgress.style.width='100%';
    return mbps;
}

// Upload
async function uploadTest(url, sizeMB=1){
    const data = new Uint8Array(sizeMB*1024*1024);
    crypto.getRandomValues(data);
    const start = performance.now();
    try{ await fetch(url+'?cache='+Math.random(), {method:'POST', body:data}); } catch(e){}
    const end = performance.now();
    const seconds = (end-start)/1000;
    const mbps = ((sizeMB*8)/seconds).toFixed(1);
    uploadProgress.style.width='100%';
    return mbps;
}

// Run Test
async function runSpeedTest(){
    startBtn.disabled=true;
    startBtn.textContent='Testing...';

    pingBox.textContent='Ping: -- ms | Jitter: -- ms';
    downloadBox.textContent='Download: -- Mbps';
    uploadBox.textContent='Upload: -- Mbps';
    pingProgress.style.width='0%';
    downloadProgress.style.width='0%';
    uploadProgress.style.width='0%';

    const testFile = 'https://speed.hetzner.de/10MB.bin';
    const uploadURL = 'https://httpbin.org/post';

    try{
        const pingRes = await pingTest(testFile);
        pingBox.textContent = `Ping: ${pingRes.avg} ms | Jitter: ${pingRes.jitter} ms`;

        const download = await downloadTest(testFile, 10);
        downloadBox.textContent = `Download: ${download} Mbps`;

        const upload = await uploadTest(uploadURL, 1);
        uploadBox.textContent = `Upload: ${upload} Mbps`;

        saveHistory({
            time: new Date().toLocaleString(),
            ping: pingRes.avg,
            jitter: pingRes.jitter,
            download,
            upload
        });
    } catch(err){
        console.error(err);
        alert('Speed test failed!');
    }

    startBtn.disabled=false;
    startBtn.textContent='Start Test';
}

startBtn.addEventListener('click', runSpeedTest);
</script>
</body>
</html>
