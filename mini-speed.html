<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Speed Test</title>
<script src="https://public.librespeed.org/librespeed.js"></script>
<style>
body {
    margin:0;
    font-family:'Orbitron',sans-serif;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    background:#020617;
    color:#00d2ff;
}

/* Main mini box */
#mainBox {
    width:220px;  /* 3.7 inch approx */
    height:100px; /* 1.7 inch approx */
    background:rgba(0,0,0,0.6);
    border:1px solid #00d2ff;
    border-radius:10px;
    position:relative;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:5px;
    box-sizing:border-box;
}

/* Graph area */
#graph {
    flex:1;
    width:100%;
    position:relative;
}

/* Center line */
#line {
    position:absolute;
    top:50%;
    width:100%;
    height:1px;
    background:#00d2ff;
    transform:translateY(-50%);
}

/* Bars */
.bar {
    position:absolute;
    width:6px;
    background:linear-gradient(to top,#00d2ff,#3a47d5);
    bottom:50%;
}

.bar.upload {
    bottom:auto;
    top:50%;
    transform-origin:bottom;
}

/* Small stats labels */
#stats {
    display:flex;
    justify-content:space-around;
    width:100%;
    margin-top:3px;
    font-size:0.7rem;
}

/* Start button */
button {
    margin-top:2px;
    padding:3px 6px;
    background:#00d2ff;
    color:black;
    border:none;
    border-radius:5px;
    font-size:0.7rem;
    cursor:pointer;
}
button:hover {
    background:#3a47d5;
    color:white;
}
</style>
</head>
<body>

<div id="mainBox">
    <div id="graph">
        <div id="line"></div>
        <!-- Upload & Download bars will be added dynamically -->
    </div>
    <div id="stats">
        <div>DL: <span id="downloadVal">--</span></div>
        <div>UL: <span id="uploadVal">--</span></div>
        <div>P: <span id="pingVal">--</span></div>
        <div>J: <span id="jitterVal">--</span></div>
    </div>
    <button id="startBtn">ðŸ”„ Start</button>
</div>

<script>
const graph = document.getElementById('graph');
const downloadVal = document.getElementById('downloadVal');
const uploadVal = document.getElementById('uploadVal');
const pingVal = document.getElementById('pingVal');
const jitterVal = document.getElementById('jitterVal');
const startBtn = document.getElementById('startBtn');

let uploadBars = [];
let downloadBars = [];
let pings = [];

// Create 20 bars for upload & download
for(let i=0;i<20;i++){
    let uBar = document.createElement('div');
    uBar.className='bar upload';
    uBar.style.left = `${i*10}px`;
    graph.appendChild(uBar);
    uploadBars.push(uBar);

    let dBar = document.createElement('div');
    dBar.className='bar';
    dBar.style.left = `${i*10}px`;
    graph.appendChild(dBar);
    downloadBars.push(dBar);
}

async function runTest(){
    const test = new Librespeed({server:'https://test.librespeed.org', download:true, upload:true, ping:true});

    test.on('download', val=>{
        const mbps = (val/125000).toFixed(1);
        downloadVal.textContent = mbps;
        downloadBars.forEach((bar,i)=>{
            let h = Math.min((val/1250000)*50,50); // scale height max 50px
            bar.style.height = `${(i<Math.floor(mbps/5)?h:0)}px`;
        });
    });

    test.on('upload', val=>{
        const mbps = (val/125000).toFixed(1);
        uploadVal.textContent = mbps;
        uploadBars.forEach((bar,i)=>{
            let h = Math.min((val/1250000)*50,50);
            bar.style.height = `${(i<Math.floor(mbps/5)?h:0)}px`;
        });
    });

    test.on('ping', val=>{
        pingVal.textContent = val.toFixed(0);
        pings.push(val);
        if(pings.length>5) pings.shift();
        let jitter = Math.max(...pings)-Math.min(...pings);
        jitterVal.textContent = jitter.toFixed(0);
    });

    try{
        await test.start();
    }catch(e){
        console.error('Speed Test Error', e);
    }
}

startBtn.addEventListener('click',runTest);

// Auto run every 30s
runTest();
setInterval(runTest,30000);
</script>

</body>
</html>
